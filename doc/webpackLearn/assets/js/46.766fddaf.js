(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{84:function(a,e,t){"use strict";t.r(e);var s=t(0),o=Object(s.a)({},function(){var a=this.$createElement;this._self._c;return this._m(0)},[function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"content"},[t("h1",{attrs:{id:"_3-21-加载-source-map"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-21-加载-source-map","aria-hidden":"true"}},[a._v("#")]),a._v(" 3-21 加载 Source Map")]),t("p",[a._v("由于在开发过程中经常会使用新语言去开发项目，最后会把源码转换成能在浏览器中直接运行的 JavaScript 代码。 这样做虽能提升开发效率，在调试代码的过程中你会发现生成的代码可读性非常差，这给代码调试带来了不便。")]),t("p",[a._v("Webpack 支持为转换生成的代码输出对应的 Source Map 文件，以方便在浏览器中能通过源码调试。 控制 Source Map 输出的 Webpack 配置项是 "),t("code",[a._v("devtool")]),a._v("，它有很多选项，下面来一一详细介绍。")]),t("table",[t("thead",[t("tr",[t("th",[a._v("devtool")]),t("th",[a._v("含义")])])]),t("tbody",[t("tr",[t("td",[a._v("空")]),t("td",[a._v("不生成 Source Map")])]),t("tr",[t("td",[t("code",[a._v("eval")])]),t("td",[a._v("每个 module 会封装到 eval 里包裹起来执行，并且会在每个 eval 语句的末尾追加注释 "),t("code",[a._v("//# sourceURL=webpack:///./main.js")])])]),t("tr",[t("td",[t("code",[a._v("source-map")])]),t("td",[a._v("会额外生成一个单独 Source Map 文件，并且会在 JavaScript 文件末尾追加 "),t("code",[a._v("//# sourceMappingURL=bundle.js.map")])])]),t("tr",[t("td",[t("code",[a._v("hidden-source-map")])]),t("td",[a._v("和 source-map 类似，但不会在 JavaScript 文件末尾追加 "),t("code",[a._v("//# sourceMappingURL=bundle.js.map")])])]),t("tr",[t("td",[t("code",[a._v("inline-source-map")])]),t("td",[a._v("和 source-map 类似，但不会额外生成一个单独 Source Map 文件，而是把 Source Map 转换成 base64 编码内嵌到 JavaScript 中")])]),t("tr",[t("td",[t("code",[a._v("eval-source-map")])]),t("td",[a._v("和 eval 类似，但会把每个模块的 Source Map 转换成 base64 编码内嵌到 eval 语句的末尾，例如")])]),t("tr",[t("td",[t("code",[a._v("cheap-source-map")])]),t("td",[a._v("和 source-map 类似，但生成的 Source Map 文件中没有列信息，因此生成速度更快")])]),t("tr",[t("td",[t("code",[a._v("cheap-module-source-map")])]),t("td",[a._v("和 cheap-source-map 类似，但会包含 Loader 生成的 Source Map")])])])]),t("p",[a._v("其实以上表格只是列举了 devtool 可能取值的一部分， 它的取值其实可以由 "),t("code",[a._v("source-map")]),a._v("、"),t("code",[a._v("eval")]),a._v("、"),t("code",[a._v("inline")]),a._v("、"),t("code",[a._v("hidden")]),a._v("、"),t("code",[a._v("cheap")]),a._v("、"),t("code",[a._v("module")]),a._v(" 这六个关键字随意组合而成。 这六个关键字每个都代表一种特性，它们的含义分别是：")]),t("ul",[t("li",[t("code",[a._v("eval")]),a._v("：用 eval 语句包裹需要安装的模块；")]),t("li",[t("code",[a._v("source-map")]),a._v("：生成独立的 Source Map 文件；")]),t("li",[t("code",[a._v("hidden")]),a._v("：不在 JavaScript 文件中指出 Source Map 文件所在，这样浏览器就不会自动加载 Source Map；")]),t("li",[t("code",[a._v("inline")]),a._v("：把生成的 Source Map 转换成 base64 格式内嵌在 JavaScript 文件中；")]),t("li",[t("code",[a._v("cheap")]),a._v("：生成的 Source Map 中不会包含列信息，这样计算量更小，输出的 Source Map 文件更小；同时 Loader 输出的 Source Map 不会被采用；")]),t("li",[t("code",[a._v("module")]),a._v("：来自 Loader 的 Source Map 被简单处理成每行一个模块；")])]),t("h2",{attrs:{id:"该如何选择"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#该如何选择","aria-hidden":"true"}},[a._v("#")]),a._v(" 该如何选择")]),t("p",[t("code",[a._v("Devtool")]),a._v(" 配置项提供的这么多选项看似简单，但很多人搞不清楚它们之间的差别和应用场景。")]),t("p",[a._v("如果你不关心细节和性能，只是想在不出任何差错的情况下调试源码，可以直接设置成 "),t("code",[a._v("source-map")]),a._v("，但这样会造成两个问题：")]),t("ul",[t("li",[t("p",[a._v("source-map 模式下会输出质量最高最详细的 Source Map，这会造成构建速度缓慢，特别是在开发过程需要频繁修改的时候会增加等待时间；")])]),t("li",[t("p",[a._v("source-map 模式下会把 Source Map 暴露出去，如果 "),t("strong",[a._v("构建发布到线上的代码的 Source Map 暴露出去就等于源码被泄露")]),a._v("；\n为了解决以上两个问题，可以这样做：")])]),t("li",[t("p",[a._v("在开发环境下把 devtool 设置成 "),t("code",[a._v("cheap-module-eval-source-map")]),a._v("，因为生成这种 Source Map 的 "),t("strong",[a._v("速度最快，能加速构建")]),a._v("。由于在开发环境下不会做代码压缩，Source Map 中即使没有列信息也不会影响断点调试；")])]),t("li",[t("p",[a._v("在生产环境下把 devtool 设置成 "),t("code",[a._v("hidden-source-map")]),a._v("，意思是生成最详细的 Source Map，但不会把 Source Map 暴露出去。由于在生产环境下会做代码压缩，一个 JavaScript 文件只有一行，所以需要列信息。")])])]),t("blockquote",[t("p",[a._v("在生产环境下通常不会把 Source Map 上传到 HTTP 服务器让用户获取，而是 "),t("strong",[a._v("上传到 JavaScript 错误收集系统")]),a._v("，在错误收集系统上根据 Source Map 和收集到的 JavaScript 运行错误堆栈计算出错误所在源码的位置。")]),t("p",[a._v("不要在生产环境下使用 "),t("code",[a._v("inline")]),a._v(" 模式的 Source Map， 因为这会使 JavaScript 文件变得很大，而且会泄露源码。")])]),t("h2",{attrs:{id:"加载现有的-source-map"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#加载现有的-source-map","aria-hidden":"true"}},[a._v("#")]),a._v(" 加载现有的 Source Map")]),t("p",[a._v("有些从 Npm 安装的第三方模块是采用 ES6 或者 TypeScript 编写的，它们在发布时会同时带上编译出来的 JavaScript 文件和对应的 Source Map 文件，以方便你在使用它们出问题的时候调试它们；")]),t("p",[a._v("默认情况下 Webpack 是不会去加载这些附加的 Source Map 文件的，Webpack 只会在转换过程中生成 "),t("code",[a._v("Source Map")]),a._v("。 为了让 Webpack 加载这些附加的 Source Map 文件，需要安装 "),t("code",[a._v("source-map-loader")]),a._v("。 使用方法如下：")]),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[a._v("module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    rules"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token regex"}},[a._v("/\\.js$/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 只加载你关心的目录下的 Source Map，以提升构建速度")]),a._v("\n        include"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("path"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("resolve")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"node_modules/some-components/"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n        use"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"source-map-loader"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 要把 source-map-loader 的执行顺序放到最前面，如果在 source-map-loader 之前有 Loader 转换了该 JavaScript 文件，会导致 Source Map 映射错误")]),a._v("\n        enforce"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"pre"')]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("p",[a._v("由于 "),t("code",[a._v("source-map-loader")]),a._v("在加载 "),t("code",[a._v("Source Map")]),a._v(" 时计算量很大，因此要避免让该 Loader 处理过多的文件，不然会导致构建速度缓慢。 "),t("strong",[a._v("通常会采用 include 去命中只关心的文件")]),a._v("。")]),t("p",[a._v("再安装新引入的依赖：")]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" i -D source-map-loader\n")])])]),t("p",[a._v("重启 Webpack 后，你就能在浏览器中调试 "),t("code",[a._v("node_modules/some-components/")]),a._v(" 目录下的源码了。")])])}],!1,null,null,null);e.default=o.exports}}]);